"/*
Listing of all photos tagged with #asFound
This tagging is done by Starlite when a photo relates to a hazard
*/
select i.inspectionnumber as InspectionNumber
       ,i.linknumber as PermitNumber
       ,i.actualenddate as InspectionDate
       ,it.name as InspectionType
       ,substr(a.filename, -3) as filetype
       ,a.notes as attachmentnotes
       ,csi.hazardmapcellreference
       ,haf.description as hazardmap
       ,csi.hazardratingbymap
       ,csi.hazardratingbyso
       ,dbms_lob.substr(csi.descriptionofhazard,1024,1) as hazarddesc
       ,haf.rating as hazardmaprating
       ,haf.description as hazardmapdescription
       ,a.filename as filename
       ,'file://x:/photopub/docs/' || substr(a.filepath,15) || a.attachmentid || substr(a.filename,-4) as photolink
       ,'http://app02/energovprod/Default.aspx?Link=EnerGovSilverlight_Inspections_ManageInspection__' || replace(i.iminspectionid,'-','_') as InspectionLink

  from iminspection i
  join iminspectiontype it on i.iminspectiontypeid = it.iminspectiontypeid
  join customsaverinspections csi on i.iminspectionid = csi.id
  join attachment a on i.iminspectionid = a.parentid
  left outer join attachmentgroup ag on a.attachmentgroupid = ag.attachmentgroupid
  left outer join bcsacustom.bcsahazardasfound haf on trim(lower(haf.asfoundcode)) = trim(lower(csi.hazardmapcellreference))
 where (     lower(a.notes) like '%#asfound%'
             or lower(a.notes) like '#asfound%'
             /* Exclude files that have hazard or as found text in the notes */
             /*
             or lower(a.notes) like '%hazard%'
             or lower(a.notes) like '%as found%'
             */
       )",,,,
"/* Terse whitelist of tagged attachments */
select /* terse */ substr(a.filepath,15) || a.attachmentid || substr(a.filename,-4) as adjfilepath
  from attachment a
 where (     lower(a.notes) like '%#asfound%'
             or lower(a.notes) like '#asfound%'
       )",,,,
,,,,
,,,,
,,,,
,,,,
,,,,
,,,,
,,,,
,,,,